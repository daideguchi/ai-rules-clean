# ğŸš¨ ç¾åœ¨ã‚¹ãƒãƒ¼ãƒˆç¢ºèªã‚·ã‚¹ãƒ†ãƒ  - å®Œå…¨å»ƒæ­¢æ±ºå®šãƒ»å•é¡Œç·æ‹¬

**åˆ†ææ—¥æ™‚**: 2025-07-15T12:XX:XX  
**å¤–éƒ¨AIæ¤œè¨¼**: O3 + Geminiå®Œäº†  
**æ±ºå®š**: ç¾åœ¨ã‚·ã‚¹ãƒ†ãƒ å®Œå…¨å»ƒæ­¢ãƒ»ã‚¼ãƒ­ã‹ã‚‰å†è¨­è¨ˆ

## ğŸ’€ ç¾åœ¨ã‚·ã‚¹ãƒ†ãƒ ã®è‡´å‘½çš„æ¬ é™¥ç·æ‹¬

### 1. **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è² å‚µ - æ§‹é€ çš„ç ´ç¶»**

#### å˜ä¸€è²¬ä»»åŸå‰‡ã®å®Œå…¨é•å
```python
# å•é¡Œï¼š1ã‚¯ãƒ©ã‚¹ãŒå…¨ã¦ã®è²¬ä»»ã‚’è² ã†
class SmartSessionChecker:
    def smart_check()           # ç¢ºèªå®Ÿè¡Œ
    def load_cache()           # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†
    def save_cache()           # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä¿å­˜
    def check_cursor_rules()   # å€‹åˆ¥ç¢ºèª
    def check_president_status() # çŠ¶æ…‹ç¢ºèª
    def generate_template()    # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”Ÿæˆ
    # â†’ çµæœï¼šå¤‰æ›´æ™‚ã®å‰¯ä½œç”¨äºˆæ¸¬ä¸èƒ½
```

#### å¯†çµåˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
```python
# å•é¡Œï¼šç›´æ¥ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ãƒ»ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ä¾å­˜
def check_president_status(self):
    session_file = self.project_root / "runtime" / "secure_state" / "president_session.json"
    # â†’ ãƒ†ã‚¹ãƒˆä¸èƒ½ãƒ»å¤‰æ›´æ³¢åŠãƒ»æ‹¡å¼µå›°é›£
```

### 2. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ  - æ ¹æœ¬è¨­è¨ˆãƒŸã‚¹**

#### æ™‚é–“ãƒ™ãƒ¼ã‚¹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®è‡´å‘½çš„å•é¡Œ
```python
# ç¾åœ¨ã®æ¬ é™¥ãƒ­ã‚¸ãƒƒã‚¯
cache_time = datetime.fromisoformat(cache.get('timestamp', '2000-01-01'))
if datetime.now() - cache_time < self.cache_validity:
    return cache  # â† çŠ¶æ…‹å¤‰æ›´ç„¡è¦–ã§å¤ã„ãƒ‡ãƒ¼ã‚¿è¿”å´

# ç™ºç”Ÿã™ã‚‹å•é¡Œ
1. PRESIDENTå®£è¨€å¾Œã‚‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒâŒã‚’è¿”ã™
2. ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«åæ˜ ã•ã‚Œãªã„
3. å¼·åˆ¶ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥(--force)ã§ã—ã‹æ­£ç¢ºãªçŠ¶æ…‹å–å¾—ä¸èƒ½
4. ä¸¦è¡Œå®Ÿè¡Œæ™‚ã®ç«¶åˆçŠ¶æ…‹
```

#### ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼è¨­è¨ˆã®æ¬ é™¥
```python
# å•é¡Œï¼šçŠ¶æ…‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ»ä¾å­˜é–¢ä¿‚ã‚’ç„¡è¦–
cache_key = "president_status"  # â† çŠ¶æ…‹å¤‰æ›´ã¨ç„¡é–¢ä¿‚ãªå›ºå®šã‚­ãƒ¼
# å¿…è¦ï¼šçŠ¶æ…‹ãƒãƒƒã‚·ãƒ¥ãƒ»ä¾å­˜é–¢ä¿‚ãƒ»ãƒãƒ¼ã‚¸ãƒ§ãƒ³å«ã‚€å‹•çš„ã‚­ãƒ¼
cache_key = f"president_status_{state_hash}_{dependencies_hash}_{version}"
```

### 3. **çŠ¶æ…‹ç®¡ç† - å®Œå…¨ç ´ç¶»**

#### çŠ¶æ…‹åŒæœŸã®ä¸å­˜åœ¨
```yaml
å•é¡Œã®æ ¹æœ¬:
  - è¤‡æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒç‹¬ç«‹ã—ã¦çŠ¶æ…‹å¤‰æ›´
  - å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆã®ä¼æ’­ä»•çµ„ã¿ãªã—
  - ä¾å­˜é–¢ä¿‚ã®è¿½è·¡ä¸èƒ½
  - æ•´åˆæ€§ä¿è¨¼ãªã—

å…·ä½“çš„äº‹ä¾‹:
  - make declare-presidentå®Ÿè¡Œ
  - PRESIDENTçŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°
  - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯å¤ã„âŒçŠ¶æ…‹ã‚’ä¿æŒ
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼æ··ä¹±ãƒ»ä¿¡é ¼å¤±å¢œ
```

#### ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã®ä¸€è²«æ€§æ¬ å¦‚
```python
# å•é¡Œï¼šè¤‡æ•°ã®çŠ¶æ…‹è¡¨ç¾ãŒæ··åœ¨
president_status.get('status') == 'active'          # å¤ã„ãƒ­ã‚¸ãƒƒã‚¯
president_status.get('president_declared') == True  # æ–°ã—ã„ãƒ­ã‚¸ãƒƒã‚¯
# â†’ 'status' vs 'president_declared'æ··ä¹±ã®åŸå› 
```

### 4. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° - ä½“ç³»çš„ä¸å‚™**

#### ä¾‹å¤–å‡¦ç†ã®æŠ½è±¡åº¦ä¸é©åˆ‡
```python
# ç¾åœ¨ï¼šã™ã¹ã¦ã‚’åŒä¸€ãƒ¬ãƒ™ãƒ«ã§å‡¦ç†
except Exception as e:
    return {"status": "âš ï¸", "details": f"ç¢ºèªã‚¨ãƒ©ãƒ¼: {e}"}

# å•é¡Œï¼š
1. FileNotFoundErrorï¼ˆè¨­å®šä¸å‚™ï¼‰ã¨PermissionErrorï¼ˆæ¨©é™å•é¡Œï¼‰ã‚’åŒä¸€è¦–
2. ä¸€æ™‚çš„ã‚¨ãƒ©ãƒ¼ã¨æ’ä¹…çš„ã‚¨ãƒ©ãƒ¼ã®åŒºåˆ¥ãªã—
3. è‡ªå‹•å¾©æ—§å¯èƒ½æ€§ã®åˆ¤å®šãªã—
4. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®å…·ä½“çš„å¯¾å‡¦æ³•æç¤ºãªã—
```

#### å›å¾©æˆ¦ç•¥ã®ä¸å­˜åœ¨
```python
# ç¾åœ¨ï¼šã‚¨ãƒ©ãƒ¼æ™‚ã¯è«¦ã‚ã¦å¤±æ•—å ±å‘Š
# å¿…è¦ï¼šæ®µéšçš„ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
1. ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¤±æ•— â†’ ç›´æ¥ç¢ºèª
2. ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿å¤±æ•— â†’ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
3. æ¨©é™ã‚¨ãƒ©ãƒ¼ â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡ç¤ºè¦æ±‚
4. ä¸€æ™‚çš„éšœå®³ â†’ æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ã§å†è©¦è¡Œ
```

### 5. **å“è³ªä¿è¨¼ - å®Œå…¨æ¬ å¦‚**

#### ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã®ä¸å­˜åœ¨
```bash
# ç¾åœ¨ã®ãƒ†ã‚¹ãƒˆçŠ¶æ³
ls tests/ | grep smart-session  # â†’ ç©º
pytest -k smart_session        # â†’ 0 tests collected

# çµæœï¼šä¿®æ­£ã®åº¦ã«æ–°ãŸãªæ¬ é™¥æ··å…¥ç¢ºå®Ÿ
```

#### çµ±åˆãƒ†ã‚¹ãƒˆã®ä¸å­˜åœ¨
```python
# ä¸å­˜åœ¨ã®ãƒ†ã‚¹ãƒˆä¾‹
def test_president_declaration_cache_invalidation():
    """PRESIDENTå®£è¨€å¾Œã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–ç¢ºèª"""
    
def test_concurrent_cache_access():
    """ä¸¦è¡Œã‚¢ã‚¯ã‚»ã‚¹æ™‚ã®ä¸€è²«æ€§ç¢ºèª"""
    
def test_file_change_detection():
    """ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´æ™‚ã®è‡ªå‹•ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ›´æ–°ç¢ºèª"""
```

### 6. **é‹ç”¨ãƒ»ç›£è¦– - å¯è¦–æ€§ã‚¼ãƒ­**

#### è¨ºæ–­æƒ…å ±ã®ä¸è¶³
```python
# ç¾åœ¨ï¼šæˆåŠŸ/å¤±æ•—ã®2å€¤ã®ã¿
return {"status": "âœ…", "details": "PRESIDENTå®£è¨€æ¸ˆã¿"}

# å¿…è¦ï¼šè©³ç´°è¨ºæ–­æƒ…å ±
return {
    "status": "âœ…",
    "details": "PRESIDENTå®£è¨€æ¸ˆã¿", 
    "timestamp": "2025-07-15T12:00:00",
    "cache_status": "hit",
    "file_last_modified": "2025-07-15T11:39:28",
    "check_duration_ms": 42,
    "dependencies": ["president_session.json", "unified_president_tool.py"]
}
```

#### ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆã®ä¸å­˜åœ¨
```python
# ä¸å­˜åœ¨ã®ç›£è¦–é …ç›®
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡
- ç¢ºèªå‡¦ç†æ™‚é–“
- ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿé »åº¦
- çŠ¶æ…‹ä¸æ•´åˆæ¤œå‡º
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹å¤±æ•—
```

## ğŸ”¥ å»ƒæ­¢æ±ºå®šã®æ ¹æ‹ 

### O3åˆ†æçµæœ
ã€Œä¿®æ­£ãŒç—‡çŠ¶ã«ãƒ‘ãƒƒãƒã‚’å½“ã¦ã‚‹ã ã‘ã§ã€æ ¸å¿ƒçš„æ§‹é€ å•é¡Œã«å¯¾å‡¦ã—ã¦ã„ãªã„ã€

### Geminiåˆ†æçµæœ  
ã€Œè¨­å®šç®¡ç†ã‚’é‡è¦ãªã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã¯ãªãã€ç°¡å˜ãªãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†ã‚¿ã‚¹ã‚¯ã¨ã—ã¦æ‰±ã£ã¦ã„ã‚‹ã€

### å®Ÿè¨¼ã•ã‚ŒãŸäº‹å®Ÿ
1. **3å›ã®ä¿®æ­£ã§3å›ã¨ã‚‚æ–°ãŸãªæ¬ é™¥æ··å…¥**
2. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥å•é¡Œã¯æ™‚é–“ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã®æ ¹æœ¬æ¬ é™¥**
3. **çŠ¶æ…‹åŒæœŸå•é¡Œã¯ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ¬ãƒ™ãƒ«ã®è¨­è¨ˆãƒŸã‚¹**
4. **å“è³ªä¿è¨¼ãªã—ã§ã¯æ”¹å–„ä¸å¯èƒ½**

## ğŸ¯ å®Œå…¨å»ƒæ­¢ä½œæ¥­

### 1. ç¾åœ¨ã‚·ã‚¹ãƒ†ãƒ ã®ç„¡åŠ¹åŒ–
```bash
# ã‚¹ãƒãƒ¼ãƒˆç¢ºèªã‚·ã‚¹ãƒ†ãƒ å®Œå…¨åœæ­¢
mv scripts/automation/smart-session-check.py scripts/automation/smart-session-check.py.DEPRECATED
mv scripts/automation/update-claude-md-template.py scripts/automation/update-claude-md-template.py.DEPRECATED

# CLAUDE.mdã‹ã‚‰ã‚¹ãƒãƒ¼ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé™¤å»
# Makefileã‹ã‚‰smart-checkç³»ã‚³ãƒãƒ³ãƒ‰é™¤å»
```

### 2. æ—¢å­˜ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å®Œå…¨å‰Šé™¤
```bash
rm -f runtime/session_check_cache.json
rm -rf runtime/cache/
```

### 3. è¨­å®šã®åˆæœŸåŒ–
```bash
# CLAUDE.mdã‚’å…ƒã®å¿…é ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«å¾©å…ƒ
cp runtime/config_backups/CLAUDE.md.backup CLAUDE.md
```

## ğŸ“‹ æ–°ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶å®šç¾©

### æ©Ÿèƒ½è¦ä»¶
1. **çŠ¶æ…‹ç¢ºèªã‚·ã‚¹ãƒ†ãƒ **: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ»é«˜ç²¾åº¦ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–
2. **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”Ÿæˆ**: è»½é‡ãƒ»å‹•çš„ãƒ»ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½
3. **ã‚¨ãƒ©ãƒ¼å‡¦ç†**: åŒ…æ‹¬çš„ãƒ»è‡ªå‹•å›å¾©ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹
4. **çµ±åˆã‚·ã‚¹ãƒ†ãƒ **: CLAUDE.mdãƒ»Makefileãƒ»MCPå”æ¥­

### éæ©Ÿèƒ½è¦ä»¶
1. **æ€§èƒ½**: ç¢ºèªæ™‚é–“3ç§’ä»¥å†…ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆ1ç§’ä»¥å†…
2. **ä¿¡é ¼æ€§**: 99.9%ç²¾åº¦ãƒ»è‡ªå‹•å›å¾©ãƒ»ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ä¿è¨¼
3. **ä¿å®ˆæ€§**: å˜ä½“ãƒ†ã‚¹ãƒˆãƒ»çµ±åˆãƒ†ã‚¹ãƒˆãƒ»å›å¸°ãƒ†ã‚¹ãƒˆ
4. **æ‹¡å¼µæ€§**: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ãƒ»è¨­å®šå¤–éƒ¨åŒ–ãƒ»APIæä¾›

### å“è³ªè¦ä»¶
1. **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**: 90%ä»¥ä¸Š
2. **ã‚³ãƒ¼ãƒ‰å“è³ª**: Lintingãƒ»å‹ãƒã‚§ãƒƒã‚¯ãƒ»è¤‡é›‘åº¦åˆ¶é™
3. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ»APIãƒ»é‹ç”¨ã‚¬ã‚¤ãƒ‰
4. **ç›£è¦–**: ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ»ãƒ­ã‚°ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ

## âœ… å»ƒæ­¢å®Œäº†ç¢ºèªé …ç›®

- [ ] ç¾åœ¨ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚¡ã‚¤ãƒ«ç„¡åŠ¹åŒ–
- [ ] ã‚­ãƒ£ãƒƒã‚·ãƒ¥å®Œå…¨å‰Šé™¤
- [ ] CLAUDE.mdå¾©å…ƒ
- [ ] Makefileæ¸…æµ„åŒ–
- [ ] æ–°ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶ç¢ºå®š
- [ ] ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆé–‹å§‹

---

**çµè«–**: ç¾åœ¨ã®ã‚¹ãƒãƒ¼ãƒˆç¢ºèªã‚·ã‚¹ãƒ†ãƒ ã¯æ•‘æ¸ˆä¸èƒ½ã€‚å®Œå…¨å»ƒæ­¢ã®ä¸Šã€O3ãƒ»Geminiåˆ†æã«åŸºã¥ãæ–°ã‚·ã‚¹ãƒ†ãƒ ã‚’ã‚¼ãƒ­ã‹ã‚‰æ§‹ç¯‰ã™ã‚‹ã€‚