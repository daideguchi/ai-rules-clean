---
description: "ãƒ†ã‚¹ãƒˆè¨­è¨ˆã¨å®Ÿè£…ã‚¬ã‚¤ãƒ‰ - å˜ä½“ãƒ†ã‚¹ãƒˆã€çµ±åˆãƒ†ã‚¹ãƒˆã€E2Eãƒ†ã‚¹ãƒˆæˆ¦ç•¥"
auto_attachments: ["*.test.{js,ts,jsx,tsx}", "*.spec.{js,ts,jsx,tsx}", "**/__tests__/**/*", "jest.config.*", "vitest.config.*"]
---

# testing.mdc - ãƒ†ã‚¹ãƒˆè¨­è¨ˆã¨å®Ÿè£…ã‚¬ã‚¤ãƒ‰

## ğŸ¯ ãƒ†ã‚¹ãƒˆæˆ¦ç•¥åŸå‰‡

### ãƒ†ã‚¹ãƒˆãƒ”ãƒ©ãƒŸãƒƒãƒ‰
```
    /\
   /  \     E2E Tests (å°‘æ•°ãƒ»é‡è¦æ©Ÿèƒ½)
  /    \    10%
 /______\   Integration Tests (ä¸­ç¨‹åº¦)
/________\  20%
           Unit Tests (å¤šæ•°ãƒ»åŸºç›¤) 70%
```

### å“è³ªç›®æ¨™
- **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**: 80%ä»¥ä¸Š
- **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“**: 5åˆ†ä»¥å†…
- **ãƒ†ã‚¹ãƒˆå®‰å®šæ€§**: 95%ä»¥ä¸Šã®æˆåŠŸç‡
- **ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§**: ç†è§£ã—ã‚„ã™ãã€ä¿®æ­£ã—ã‚„ã™ã„

## ğŸ”¬ å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆUnit Testsï¼‰

### åŸºæœ¬åŸå‰‡
- **ç‹¬ç«‹æ€§**: ä»–ã®ãƒ†ã‚¹ãƒˆã«ä¾å­˜ã—ãªã„
- **é«˜é€Ÿæ€§**: 1ãƒ†ã‚¹ãƒˆ1ç§’ä»¥å†…
- **æ˜ç¢ºæ€§**: ä½•ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ã„ã‚‹ã‹æ˜ç¢º
- **ä¿¡é ¼æ€§**: æ¯å›åŒã˜çµæœ

### Jest/Vitestè¨­å®š
```javascript
// jest.config.js
module.exports = {
  testEnvironment: 'jsdom',
  setupFilesAfterEnv: ['<rootDir>/src/setupTests.js'],
  coverageReporters: ['text', 'html'],
  coverageThreshold: {
    global: {
      branches: 80,
      functions: 80,
      lines: 80,
      statements: 80
    }
  }
};
```

### ãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³
```javascript
// âœ… è‰¯ã„ä¾‹
describe('calculateTotal', () => {
  it('å•†å“ã®åˆè¨ˆé‡‘é¡ã‚’æ­£ã—ãè¨ˆç®—ã™ã‚‹', () => {
    const items = [
      { price: 100, quantity: 2 },
      { price: 200, quantity: 1 }
    ];
    expect(calculateTotal(items)).toBe(400);
  });

  it('ç©ºã®é…åˆ—ã®å ´åˆã¯0ã‚’è¿”ã™', () => {
    expect(calculateTotal([])).toBe(0);
  });
});
```

## ğŸ”§ çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆIntegration Testsï¼‰

### React Testing Library
```javascript
import { render, screen, fireEvent } from '@testing-library/react';
import userEvent from '@testing-library/user-event';

test('ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ãŒæ­£ã—ãå‹•ä½œã™ã‚‹', async () => {
  render(<LoginForm />);
  
  const emailInput = screen.getByLabelText('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹');
  const passwordInput = screen.getByLabelText('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰');
  const submitButton = screen.getByRole('button', { name: 'ãƒ­ã‚°ã‚¤ãƒ³' });
  
  await userEvent.type(emailInput, 'test@example.com');
  await userEvent.type(passwordInput, 'password123');
  await userEvent.click(submitButton);
  
  expect(screen.getByText('ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ')).toBeInTheDocument();
});
```

### APIãƒ†ã‚¹ãƒˆ
```javascript
import { rest } from 'msw';
import { setupServer } from 'msw/node';

const server = setupServer(
  rest.get('/api/users', (req, res, ctx) => {
    return res(ctx.json([{ id: 1, name: 'John' }]));
  })
);

beforeAll(() => server.listen());
afterEach(() => server.resetHandlers());
afterAll(() => server.close());
```

## ğŸŒ E2Eãƒ†ã‚¹ãƒˆï¼ˆEnd-to-End Testsï¼‰

### Playwrightè¨­å®š
```javascript
// playwright.config.js
module.exports = {
  testDir: './tests',
  timeout: 30000,
  use: {
    baseURL: 'http://localhost:3000',
    headless: true,
    screenshot: 'only-on-failure',
    video: 'retain-on-failure'
  },
  projects: [
    { name: 'chromium', use: { ...devices['Desktop Chrome'] } },
    { name: 'firefox', use: { ...devices['Desktop Firefox'] } },
    { name: 'webkit', use: { ...devices['Desktop Safari'] } }
  ]
};
```

### E2Eãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³
```javascript
import { test, expect } from '@playwright/test';

test('ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ•ãƒ­ãƒ¼ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹', async ({ page }) => {
  await page.goto('/');
  
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒšãƒ¼ã‚¸ã«ç§»å‹•
  await page.click('text=æ–°è¦ç™»éŒ²');
  await expect(page).toHaveURL('/signup');
  
  // ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›
  await page.fill('[data-testid="email"]', 'test@example.com');
  await page.fill('[data-testid="password"]', 'password123');
  await page.fill('[data-testid="confirm-password"]', 'password123');
  
  // é€ä¿¡
  await page.click('[data-testid="submit-button"]');
  
  // æˆåŠŸç¢ºèª
  await expect(page.locator('text=ç™»éŒ²å®Œäº†')).toBeVisible();
});
```

## ğŸ“± ãƒ¢ãƒã‚¤ãƒ«ãƒ†ã‚¹ãƒˆ

### ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ†ã‚¹ãƒˆ
```javascript
test('ãƒ¢ãƒã‚¤ãƒ«ãƒ“ãƒ¥ãƒ¼ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹', async ({ page }) => {
  await page.setViewportSize({ width: 375, height: 667 });
  await page.goto('/');
  
  // ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ç¢ºèª
  await expect(page.locator('[data-testid="mobile-menu"]')).toBeVisible();
  
  // ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒéè¡¨ç¤º
  await expect(page.locator('[data-testid="desktop-menu"]')).toBeHidden();
});
```

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ

### åŸºæœ¬çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
```javascript
test('XSSæ”»æ’ƒã‹ã‚‰ä¿è­·ã•ã‚Œã¦ã„ã‚‹', async ({ page }) => {
  await page.goto('/search');
  
  const maliciousInput = '<script>alert("xss")</script>';
  await page.fill('[data-testid="search-input"]', maliciousInput);
  await page.click('[data-testid="search-button"]');
  
  // XSSãŒå®Ÿè¡Œã•ã‚Œãªã„ã“ã¨ã‚’ç¢ºèª
  const alerts = [];
  page.on('dialog', dialog => {
    alerts.push(dialog.message());
    dialog.dismiss();
  });
  
  expect(alerts).toHaveLength(0);
});
```

## ğŸš€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

### Lighthouse CI
```javascript
// lighthouse.config.js
module.exports = {
  ci: {
    collect: {
      url: ['http://localhost:3000'],
      numberOfRuns: 3,
    },
    assert: {
      assertions: {
        'categories:performance': ['error', { minScore: 0.9 }],
        'categories:accessibility': ['error', { minScore: 0.9 }],
        'categories:best-practices': ['error', { minScore: 0.9 }],
        'categories:seo': ['error', { minScore: 0.9 }],
      },
    },
  },
};
```

## ğŸ” ãƒ†ã‚¹ãƒˆãƒ‡ãƒãƒƒã‚°

### ãƒ‡ãƒãƒƒã‚°æŠ€æ³•
```javascript
// ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚ã®ãƒ‡ãƒãƒƒã‚°
test('ãƒ‡ãƒãƒƒã‚°ä¾‹', async ({ page }) => {
  await page.goto('/');
  
  // ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆå–å¾—
  await page.screenshot({ path: 'debug-screenshot.png' });
  
  // HTMLå‡ºåŠ›
  console.log(await page.content());
  
  // è¦ç´ ã®ç¢ºèª
  await page.locator('button').screenshot({ path: 'button.png' });
});
```

## ğŸ“Š ãƒ†ã‚¹ãƒˆãƒ¡ãƒˆãƒªã‚¯ã‚¹

### é‡è¦æŒ‡æ¨™
- **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**: ã‚³ãƒ¼ãƒ‰ã®ä½•%ãŒãƒ†ã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹ã‹
- **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“**: CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®åŠ¹ç‡æ€§
- **ãƒ†ã‚¹ãƒˆå®‰å®šæ€§**: ãƒ•ãƒ¬ãƒ¼ã‚¯ï¼ˆä¸å®‰å®šï¼‰ãªãƒ†ã‚¹ãƒˆã®å‰²åˆ
- **æ¬ é™¥æ¤œå‡ºç‡**: ãƒ†ã‚¹ãƒˆã§è¦‹ã¤ã‹ã‚‹ãƒã‚°ã®å‰²åˆ

### ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
```bash
# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆ
npm run test:coverage

# E2Eãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆ
npx playwright show-report
```

## ğŸ› ï¸ CI/CDçµ±åˆ

### GitHub Actionsè¨­å®š
```yaml
name: Tests
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Run unit tests
        run: npm run test:unit
      
      - name: Run E2E tests
        run: npm run test:e2e
      
      - name: Upload coverage
        uses: codecov/codecov-action@v3
```

## ğŸš¨ ãƒ†ã‚¹ãƒˆã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³

### é¿ã‘ã‚‹ã¹ããƒ‘ã‚¿ãƒ¼ãƒ³
- **ãƒ†ã‚¹ãƒˆã®ä¾å­˜é–¢ä¿‚**: ãƒ†ã‚¹ãƒˆé–“ã®é †åºä¾å­˜
- **ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°**: æ—¥ä»˜ã€æ™‚åˆ»ã€ãƒ©ãƒ³ãƒ€ãƒ å€¤
- **éåº¦ãªãƒ¢ãƒƒã‚¯**: å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒ†ã‚¹ãƒˆã—ãªã„
- **é•·ã™ãã‚‹ãƒ†ã‚¹ãƒˆ**: è¤‡æ•°ã®ã“ã¨ã‚’ä¸€åº¦ã«ãƒ†ã‚¹ãƒˆ

### ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
- **AAA ãƒ‘ã‚¿ãƒ¼ãƒ³**: Arrange, Act, Assert
- **èª¬æ˜çš„ãªãƒ†ã‚¹ãƒˆå**: ä½•ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ã„ã‚‹ã‹æ˜ç¢ºã«
- **é©åˆ‡ãªã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³**: æœŸå¾…ã•ã‚Œã‚‹çµæœã‚’æ­£ç¢ºã«æ¤œè¨¼
- **ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç®¡ç†**: ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚„ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã®æ´»ç”¨

---

**ãƒ†ã‚¹ãƒˆã¯å“è³ªä¿è¨¼ã®åŸºç›¤ã§ã™ã€‚ç¶™ç¶šçš„ã«ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã€æ”¹å–„ã—ã¦ã„ãã“ã¨ã§ã€ä¿¡é ¼æ€§ã®é«˜ã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚**
