#!/usr/bin/env python3
"""
CLAUDE.mdå¿…é ˆå¿œç­”ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ›´æ–° - ã‚¹ãƒãƒ¼ãƒˆç¢ºèªã‚·ã‚¹ãƒ†ãƒ çµ±åˆ
"""

from pathlib import Path

def update_claude_md_template():
    """CLAUDE.mdã«ã‚¹ãƒãƒ¼ãƒˆç¢ºèªã‚·ã‚¹ãƒ†ãƒ ã‚’çµ±åˆ"""
    
    claude_md_path = Path("CLAUDE.md")
    
    new_template_section = '''## ğŸ“‹ ã‚¹ãƒãƒ¼ãƒˆå¿…é ˆå¿œç­”ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ - OPTIMIZED (ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹çµ±åˆç‰ˆ)
**åŠ¹ç‡çš„ç¢ºèªã‚·ã‚¹ãƒ†ãƒ **: ã‚¿ã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«é€£å‹•ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ´»ç”¨ãƒ»ãƒˆãƒ¼ã‚¯ãƒ³æœ€é©åŒ–

```
<thinking>
{ã‚¹ãƒãƒ¼ãƒˆç¢ºèªçµæœ - ãƒ¬ãƒ™ãƒ«åˆ¥è‡ªå‹•ç”Ÿæˆ}
</thinking>

{ã‚¹ãƒãƒ¼ãƒˆç¢ºèªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‡ºåŠ›}

## ğŸ¯ ã“ã‚Œã‹ã‚‰è¡Œã†ã“ã¨
[æ—¥æœ¬èªã§ã‚¿ã‚¹ã‚¯å®£è¨€]

[English tool execution, code implementation, processing]

## âœ… å®Œé‚å ±å‘Š
- âœ… [æˆåŠŸé …ç›®]: [å…·ä½“çš„ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹è¡¨ç¤º]
- âŒ [å¤±æ•—é …ç›®]: [æŠ€è¡“çš„åŸå›  + ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹]
- âš ï¸ [æ³¨æ„äº‹é …]

**è¨˜éŒ²å ±å‘Š**:
- ğŸ“ [å†…å®¹]ã‚’[ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹]ã«è¨˜éŒ²å®Œäº†
- ğŸ“ ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«: /path/to/file
- ğŸ”§ å‡¦ç†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: [è©³ç´°çŠ¶æ³]
```

### ã‚¹ãƒãƒ¼ãƒˆç¢ºèªã‚·ã‚¹ãƒ†ãƒ ä½¿ç”¨æ–¹æ³•
```bash
# è‡ªå‹•ãƒ¬ãƒ™ãƒ«åˆ¤å®š + ç¢ºèªå®Ÿè¡Œ
make smart-check                    # SIMPLE (3ç§’)
make smart-check LEVEL=MEDIUM      # MEDIUM (5ç§’)  
make smart-check LEVEL=COMPLEX     # COMPLEX (10ç§’)
make smart-check LEVEL=CRITICAL    # CRITICAL (å®Œå…¨ç¢ºèª)

# ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç›´æ¥å–å¾—
python3 scripts/automation/smart-session-check.py --template-only
```

### ãƒ¬ãƒ™ãƒ«åˆ¥ç¢ºèªå†…å®¹
- **SIMPLE**: cursor-rulesâœ“ + presidentâœ“ (ã‚­ãƒ£ãƒƒã‚·ãƒ¥30åˆ†)
- **MEDIUM**: + system-status + recent-violations (ã‚­ãƒ£ãƒƒã‚·ãƒ¥15åˆ†)
- **COMPLEX**: + memory-state + detailed-logs (ã‚­ãƒ£ãƒƒã‚·ãƒ¥5åˆ†)
- **CRITICAL**: å®Œå…¨ç›£æŸ» (ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã—)

### å³æ ¼ãƒ«ãƒ¼ãƒ« - UPDATED
1. **ã‚¹ãƒãƒ¼ãƒˆç¢ºèªå¿…é ˆ**: å…¨å¿œç­”é–‹å§‹æ™‚ã«é©åˆ‡ãƒ¬ãƒ™ãƒ«ã§å®Ÿè¡Œ
2. **å®£è¨€éƒ¨**: æ—¥æœ¬èªï¼ˆ## ğŸ¯ ã“ã‚Œã‹ã‚‰è¡Œã†ã“ã¨ï¼‰
3. **å‡¦ç†éƒ¨**: è‹±èªï¼ˆtool calls, code, implementationï¼‰
4. **å ±å‘Šéƒ¨**: æ—¥æœ¬èªï¼ˆ## âœ… å®Œé‚å ±å‘Šï¼‰
5. **ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹å¿…é ˆè¡¨ç¤º**: å…¨ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œæ™‚
6. **è¨˜éŒ²å ´æ‰€æ˜ç¤º**: ã€‡ã€‡ã‚’ã€‡ã€‡ã«è¨˜éŒ²ã—ãŸå½¢å¼
7. **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è©³ç´°æç¤º**: å‡¦ç†çŠ¶æ³ã®å…·ä½“çš„å ±å‘Š
8. **TodoWrite**: å‡¦ç†ãƒ•ãƒ­ãƒ¼è¨˜éŒ²å¿…é ˆ

### æ®µéšçš„æ€è€ƒã‚·ã‚¹ãƒ†ãƒ  - OPTIMIZED
```yaml
SIMPLE:   <thinking>Quick: cursorâœ“ presidentâœ“ task=SIMPLE</thinking>
MEDIUM:   <thinking>Standard: rulesâœ“ systemâœ“ violations:X</thinking>
COMPLEX:  <thinking>Deep: è¤‡é›‘ãªè€ƒå¯Ÿãƒ»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆåˆ†æ</thinking>
CRITICAL: <thinking>Ultra: æœ€å¤§æ€è€ƒæ·±åº¦ãƒ»ã‚·ã‚¹ãƒ†ãƒ éšœå®³åˆ†æ</thinking>
```

### è‡ªå‹•åˆ¤å®šãƒ«ãƒ¼ãƒ«
1. ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆãƒ»ä¿®æ­£: MEDIUMä»¥ä¸Š
2. ã‚·ã‚¹ãƒ†ãƒ è¨­å®šå¤‰æ›´: COMPLEXä»¥ä¸Š  
3. é‡å¤§å•é¡Œå¯¾å¿œ: CRITICAL
4. å˜ç´”ç¢ºèªãƒ»æƒ…å ±æä¾›: SIMPLE'''
    
    # CLAUDE.mdèª­ã¿è¾¼ã¿
    content = claude_md_path.read_text()
    
    # å¤ã„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆéƒ¨åˆ†ã‚’ç‰¹å®š
    start_marker = "## ğŸ“‹ å¿…é ˆå¿œç­”ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ - MANDATORY"
    end_marker = "### æ®µéšçš„æ€è€ƒã‚·ã‚¹ãƒ†ãƒ  - MANDATORY"
    
    start_pos = content.find(start_marker)
    end_pos = content.find(end_marker)
    
    if start_pos != -1 and end_pos != -1:
        # å¤ã„éƒ¨åˆ†ã‚’æ–°ã—ã„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ç½®æ›
        new_content = (
            content[:start_pos] + 
            new_template_section + 
            "\n\n" + 
            content[end_pos:]
        )
        
        # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ
        backup_path = Path("runtime/config_backups/CLAUDE.md.backup")
        backup_path.parent.mkdir(parents=True, exist_ok=True)
        backup_path.write_text(content)
        
        # æ–°ã—ã„å†…å®¹ã§æ›´æ–°
        claude_md_path.write_text(new_content)
        
        print("âœ… CLAUDE.md ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ›´æ–°å®Œäº†")
        print(f"ğŸ“„ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: {backup_path}")
        return True
    else:
        print("âŒ CLAUDE.md ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ›´æ–°å¤±æ•— - ãƒãƒ¼ã‚«ãƒ¼æœªç™ºè¦‹")
        return False

if __name__ == "__main__":
    update_claude_md_template()