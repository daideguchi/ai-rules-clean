#!/usr/bin/env python3
"""
Slacké€šçŸ¥ã‚¹ã‚¯ãƒªãƒ—ãƒˆ - ã‚¿ã‚¹ã‚¯çŠ¶æ³ã‚’æŠ•ç¨¿
"""
import os
import requests
import json
from datetime import datetime

def send_slack_notification():
    token = os.getenv('SLACK_BOT_TOKEN')
    if not token:
        print("âŒ SLACK_BOT_TOKEN not found")
        return False
    
    # ã‚¿ã‚¹ã‚¯ã‚µãƒãƒªãƒ¼ã‚’èª­ã¿è¾¼ã¿
    try:
        with open('/tmp/task_summary.md', 'r', encoding='utf-8') as f:
            task_content = f.read()
    except FileNotFoundError:
        task_content = "ã‚¿ã‚¹ã‚¯ã‚µãƒãƒªãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
    
    message = f"""
ğŸ¤– **Claude Code ã‚¿ã‚¹ã‚¯çŠ¶æ³ãƒ¬ãƒãƒ¼ãƒˆ** 
ğŸ“… {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}

{task_content}

---
ğŸ“ Generated by Claude Code Task Management System
    """
    
    url = "https://slack.com/api/chat.postMessage"
    headers = {
        "Authorization": f"Bearer {token}",
        "Content-Type": "application/json"
    }
    
    payload = {
        "channel": "#general",  # ã¾ãŸã¯é©åˆ‡ãªãƒãƒ£ãƒ³ãƒãƒ«
        "text": message,
        "username": "Claude Code Bot",
        "icon_emoji": ":robot_face:"
    }
    
    try:
        response = requests.post(url, headers=headers, json=payload)
        result = response.json()
        
        if result.get('ok'):
            print("âœ… Slacké€šçŸ¥é€ä¿¡æˆåŠŸ")
            return True
        else:
            print(f"âŒ Slacké€šçŸ¥å¤±æ•—: {result.get('error', 'Unknown error')}")
            return False
    except Exception as e:
        print(f"âŒ Slacké€šçŸ¥ã‚¨ãƒ©ãƒ¼: {e}")
        return False

if __name__ == "__main__":
    send_slack_notification()