<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Code Web UI</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .header .subtitle {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .card h2 {
            color: #2c3e50;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #e74c3c;
            animation: pulse 2s infinite;
        }
        
        .status-indicator.active {
            background: #27ae60;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #ecf0f1;
        }
        
        .metric:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            color: #7f8c8d;
        }
        
        .metric-value {
            color: #2c3e50;
            font-weight: 600;
        }
        
        .log-container {
            grid-column: 1 / -1;
            max-height: 300px;
            overflow-y: auto;
            background: #2c3e50;
            color: #ecf0f1;
            border-radius: 12px;
            padding: 1rem;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.85rem;
        }
        
        .log-entry {
            margin-bottom: 0.5rem;
            padding: 0.25rem 0;
        }
        
        .log-timestamp {
            color: #95a5a6;
            margin-right: 0.5rem;
        }
        
        .controls {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .btn.secondary {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
        }
        
        .connection-status {
            position: fixed;
            top: 1rem;
            right: 1rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .connection-status.connected {
            background: #27ae60;
            color: white;
        }
        
        .connection-status.disconnected {
            background: #e74c3c;
            color: white;
        }
        
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                gap: 1rem;
                margin: 1rem auto;
            }
            
            .header {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="connection-status" id="connectionStatus">Êé•Á∂ö‰∏≠...</div>
    
    <header class="header">
        <h1>
            ü§ñ Claude Code Web UI
            <div class="status-indicator" id="systemStatus"></div>
        </h1>
        <div class="subtitle">Interactive Dashboard for Claude Development</div>
    </header>
    
    <div class="container">
        <div class="card">
            <h2>üìä „Ç∑„Çπ„ÉÜ„É†Áä∂ÊÖã</h2>
            <div id="systemMetrics">
                <div class="metric">
                    <span class="metric-label">„Çµ„Éº„Éê„ÉºÁ®ºÂÉçÊôÇÈñì</span>
                    <span class="metric-value" id="uptime">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">„É°„É¢„É™‰ΩøÁî®Èáè</span>
                    <span class="metric-value" id="memoryUsage">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Node.js „Éê„Éº„Ç∏„Éß„É≥</span>
                    <span class="metric-value" id="nodeVersion">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É†</span>
                    <span class="metric-value" id="platform">-</span>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>üìã „Çø„Çπ„ÇØÁÆ°ÁêÜ</h2>
            <div id="taskMetrics">
                <div class="metric">
                    <span class="metric-label">„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Çø„Çπ„ÇØ</span>
                    <span class="metric-value" id="activeTasks">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">ÂÆå‰∫Ü„Çø„Çπ„ÇØ</span>
                    <span class="metric-value" id="completedTasks">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">‰øùÁïô„Çø„Çπ„ÇØ</span>
                    <span class="metric-value" id="pendingTasks">-</span>
                </div>
            </div>
            <div class="controls">
                <button class="btn" onclick="refreshTasks()">üîÑ Êõ¥Êñ∞</button>
                <button class="btn secondary" onclick="clearLogs()">üóëÔ∏è „É≠„Ç∞„ÇØ„É™„Ç¢</button>
            </div>
        </div>
        
        <div class="card log-container">
            <h2 style="color: #ecf0f1; margin-bottom: 1rem;">üìù „É™„Ç¢„É´„Çø„Ç§„É†„É≠„Ç∞</h2>
            <div id="logs"></div>
        </div>
    </div>

    <script>
        // WebSocketÊé•Á∂ö
        const socket = io();
        let isConnected = false;
        
        // DOMË¶ÅÁ¥†
        const connectionStatus = document.getElementById('connectionStatus');
        const systemStatus = document.getElementById('systemStatus');
        const logsContainer = document.getElementById('logs');
        
        // Êé•Á∂öÁä∂ÊÖãÁÆ°ÁêÜ
        socket.on('connect', () => {
            isConnected = true;
            connectionStatus.textContent = 'Êé•Á∂öÊ∏à„Åø';
            connectionStatus.className = 'connection-status connected';
            systemStatus.className = 'status-indicator active';
            addLog('‚úÖ WebSocketÊé•Á∂ö„ÅåÁ¢∫Á´ã„Åï„Çå„Åæ„Åó„Åü');
            requestStatus();
        });
        
        socket.on('disconnect', () => {
            isConnected = false;
            connectionStatus.textContent = 'ÂàáÊñ≠';
            connectionStatus.className = 'connection-status disconnected';
            systemStatus.className = 'status-indicator';
            addLog('‚ùå WebSocketÊé•Á∂ö„ÅåÂàáÊñ≠„Åï„Çå„Åæ„Åó„Åü');
        });
        
        socket.on('welcome', (data) => {
            addLog(`üéâ ${data.message}`);
        });
        
        socket.on('status-update', (data) => {
            updateSystemMetrics(data.data);
        });
        
        // „É≠„Ç∞ÁÆ°ÁêÜ
        function addLog(message) {
            const timestamp = new Date().toLocaleTimeString('ja-JP');
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `<span class="log-timestamp">[${timestamp}]</span>${message}`;
            logsContainer.appendChild(logEntry);
            logsContainer.scrollTop = logsContainer.scrollHeight;
        }
        
        function clearLogs() {
            logsContainer.innerHTML = '';
            addLog('üóëÔ∏è „É≠„Ç∞„Åå„ÇØ„É™„Ç¢„Åï„Çå„Åæ„Åó„Åü');
        }
        
        // „Ç∑„Çπ„ÉÜ„É†ÊÉÖÂ†±Êõ¥Êñ∞
        function updateSystemMetrics(data) {
            document.getElementById('uptime').textContent = formatUptime(data.uptime);
            document.getElementById('memoryUsage').textContent = formatMemory(data.memory.rss);
        }
        
        function formatUptime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            return `${hours}ÊôÇÈñì${minutes}ÂàÜ`;
        }
        
        function formatMemory(bytes) {
            return `${(bytes / 1024 / 1024).toFixed(1)} MB`;
        }
        
        // APIÂëº„Å≥Âá∫„Åó
        async function loadSystemInfo() {
            try {
                const response = await fetch('/api/system-info');
                const data = await response.json();
                document.getElementById('nodeVersion').textContent = data.node_version;
                document.getElementById('platform').textContent = `${data.platform} ${data.arch}`;
                addLog(`üì° „Ç∑„Çπ„ÉÜ„É†ÊÉÖÂ†±„ÇíÂèñÂæó„Åó„Åæ„Åó„Åü: ${data.platform}`);
            } catch (error) {
                addLog(`‚ùå „Ç∑„Çπ„ÉÜ„É†ÊÉÖÂ†±„ÅÆÂèñÂæó„Å´Â§±Êïó: ${error.message}`);
            }
        }
        
        async function loadTasks() {
            try {
                const response = await fetch('/api/tasks');
                const data = await response.json();
                const tasks = data.tasks || [];
                
                const active = tasks.filter(t => t.status === 'in_progress').length;
                const completed = tasks.filter(t => t.status === 'completed').length;
                const pending = tasks.filter(t => t.status === 'pending').length;
                
                document.getElementById('activeTasks').textContent = active;
                document.getElementById('completedTasks').textContent = completed;
                document.getElementById('pendingTasks').textContent = pending;
                
                addLog(`üìã „Çø„Çπ„ÇØÊÉÖÂ†±„ÇíÊõ¥Êñ∞: „Ç¢„ÇØ„ÉÜ„Ç£„Éñ ${active}, ÂÆå‰∫Ü ${completed}, ‰øùÁïô ${pending}`);
            } catch (error) {
                addLog(`‚ùå „Çø„Çπ„ÇØÊÉÖÂ†±„ÅÆÂèñÂæó„Å´Â§±Êïó: ${error.message}`);
            }
        }
        
        function requestStatus() {
            socket.emit('request-status');
        }
        
        function refreshTasks() {
            loadTasks();
            requestStatus();
            addLog('üîÑ „Éá„Éº„Çø„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü');
        }
        
        // ÂàùÊúüÂåñ
        window.addEventListener('load', () => {
            addLog('üöÄ Claude Code Web UI „ÅåÈñãÂßã„Åï„Çå„Åæ„Åó„Åü');
            loadSystemInfo();
            loadTasks();
            
            // ÂÆöÊúüÊõ¥Êñ∞
            setInterval(() => {
                if (isConnected) {
                    requestStatus();
                }
            }, 30000);
            
            setInterval(loadTasks, 60000);
        });
    </script>
</body>
</html>